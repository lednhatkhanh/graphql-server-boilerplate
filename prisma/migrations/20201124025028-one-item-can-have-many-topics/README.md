# Migration `20201124025028-one-item-can-have-many-topics`

This migration has been generated by Khanh Le at 11/24/2020, 9:50:28 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "Item" DROP CONSTRAINT "Item_topicId_fkey"

ALTER TABLE "Item" DROP COLUMN "topicId"

CREATE TABLE "_ItemTopics" (
    "A" TEXT NOT NULL,
    "B" TEXT NOT NULL
)

CREATE UNIQUE INDEX "_ItemTopics_AB_unique" ON "_ItemTopics"("A", "B")

CREATE INDEX "_ItemTopics_B_index" ON "_ItemTopics"("B")

ALTER TABLE "_ItemTopics" ADD FOREIGN KEY("A")REFERENCES "Item"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_ItemTopics" ADD FOREIGN KEY("B")REFERENCES "Topic"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201123072039-add-topic-and-item-models..20201124025028-one-item-can-have-many-topics
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model User {
   id            String   @id @default(uuid())
@@ -25,9 +25,9 @@
   name           String   @unique
   description    String?
   creator        User     @relation("TopicCreator", references: [id], fields: [creatorId])
   creatorId      String
-  items          Item[]   @relation("ItemTopic")
+  items          Item[]   @relation("ItemTopics")
   parentTopic    Topic?   @relation("ParentTopic", references: [id], fields: [parentTopicId])
   parentTopicId  String?
   childrenTopics Topic[]  @relation("ParentTopic")
   createdAt      DateTime @default(now())
@@ -35,10 +35,9 @@
 }
 model Item {
   id          String   @id @default(uuid())
-  topic       Topic    @relation("ItemTopic", references: [id], fields: [topicId])
-  topicId     String
+  topics      Topic[]  @relation("ItemTopics")
   creator     User     @relation("ItemCreator", references: [id], fields: [creatorId])
   creatorId   String
   description String?
   name        String
```


