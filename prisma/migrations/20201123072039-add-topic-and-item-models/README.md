# Migration `20201123072039-add-topic-and-item-models`

This migration has been generated by Khanh Le at 11/23/2020, 2:20:39 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "Topic" (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "description" TEXT,
    "creatorId" TEXT NOT NULL,
    "parentTopicId" TEXT,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Item" (
    "id" TEXT NOT NULL,
    "topicId" TEXT NOT NULL,
    "creatorId" TEXT NOT NULL,
    "description" TEXT,
    "name" TEXT NOT NULL,
    "url" TEXT NOT NULL,
    "typeId" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "ItemType" (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Topic.name_unique" ON "Topic"("name")

CREATE UNIQUE INDEX "ItemType.name_unique" ON "ItemType"("name")

ALTER TABLE "Topic" ADD FOREIGN KEY("creatorId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Topic" ADD FOREIGN KEY("parentTopicId")REFERENCES "Topic"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Item" ADD FOREIGN KEY("topicId")REFERENCES "Topic"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Item" ADD FOREIGN KEY("creatorId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Item" ADD FOREIGN KEY("typeId")REFERENCES "ItemType"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201123040138-add-password-field-user-model..20201123072039-add-topic-and-item-models
--- datamodel.dml
+++ datamodel.dml
@@ -3,17 +3,54 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model User {
-  id        String   @id @default(uuid())
-  email     String   @unique
-  name      String
-  bio       String?
-  imageUrl  String?
-  password  String
-  createdAt DateTime @default(now())
-  updatedAt DateTime @updatedAt
+  id            String   @id @default(uuid())
+  email         String   @unique
+  name          String
+  bio           String?
+  imageUrl      String?
+  password      String
+  createdTopics Topic[]  @relation("TopicCreator")
+  createdItems  Item[]   @relation("ItemCreator")
+  createdAt     DateTime @default(now())
+  updatedAt     DateTime @updatedAt
 }
+
+model Topic {
+  id             String   @id @default(uuid())
+  name           String   @unique
+  description    String?
+  creator        User     @relation("TopicCreator", references: [id], fields: [creatorId])
+  creatorId      String
+  items          Item[]   @relation("ItemTopic")
+  parentTopic    Topic?   @relation("ParentTopic", references: [id], fields: [parentTopicId])
+  parentTopicId  String?
+  childrenTopics Topic[]  @relation("ParentTopic")
+  createdAt      DateTime @default(now())
+  updatedAt      DateTime @updatedAt
+}
+
+model Item {
+  id          String   @id @default(uuid())
+  topic       Topic    @relation("ItemTopic", references: [id], fields: [topicId])
+  topicId     String
+  creator     User     @relation("ItemCreator", references: [id], fields: [creatorId])
+  creatorId   String
+  description String?
+  name        String
+  url         String
+  type        ItemType @relation("ItemTypes", references: [id], fields: [typeId])
+  typeId      String
+  createdAt   DateTime @default(now())
+  updatedAt   DateTime @updatedAt
+}
+
+model ItemType {
+  id    String @id @default(uuid())
+  name  String @unique
+  items Item[] @relation("ItemTypes")
+}
```


